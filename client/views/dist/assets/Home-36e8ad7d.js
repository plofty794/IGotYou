import{j as N,P as G,k as e,ac as W}from"./index-e58312de.js";import{k as J,m as V,j as t,i as K,n as Q,o as Y,D as X,p as Z,q as ee,r as se,S as F,s as ae,t as ie,v as le,w as te,C as z,d as H,L as A,x as L,N as T,P as U,M as E,y as o,A as h,z as M,E as R,f as $,F as B,G as O,U as q,e as ne,H as re,I as oe,J as ce}from"./App-a5ea3e9e.js";function de(){var c,d,m;const i=(c=location.search.match(/\?(\w+)=.*/))==null?void 0:c[0].split("?")[1].split("&")[0].split("=")[1],f=(d=location.search.match(/\?(\w+)=.*/))==null?void 0:d[0].split("?")[1].split("&")[1].split("=")[1],n=(m=location.search.match(/\?(\w+)=.*/))==null?void 0:m[0].split("?")[1].split("&")[2].split("=")[1].split("+").join(" ");return J({queryKey:["listings"],queryFn:async({pageParam:x})=>await V.get(`/api/listings/${x}`,{params:{minPrice:i,maxPrice:f,serviceType:n}}),getNextPageParam:(x,l)=>l.length+1,initialPageParam:1,enabled:t.currentUser!=null&&localStorage.getItem("token")!=null})}K.register();Q.register();const p=new ce({cloud:{cloudName:"dop5kqpod"}});function ue(){var w;const{data:i,fetchNextPage:f,error:n,isPending:c,isFetchingNextPage:d}=de(),{ref:m,isIntersecting:x}=Y({threshold:1});N.useEffect(()=>{document.title="IGotYou"},[]);const l=N.useMemo(()=>i==null?void 0:i.pages.flatMap(s=>s.data.listings.filter((r,u,g)=>g.indexOf(r)==u)),[i==null?void 0:i.pages]);return N.useEffect(()=>{var s;if(n){((s=n.response)==null?void 0:s.status)===401&&(document.location.reload(),t.signOut(),localStorage.clear(),G({title:"Uh oh! Something went wrong.",description:"Please log in again.",variant:"destructive"}));return}x&&f()}),e.jsxs(e.Fragment,{children:[!((w=t.currentUser)!=null&&w.emailVerified)&&e.jsx(X,{defaultOpen:sessionStorage.getItem("checked")!=="true",children:e.jsxs(Z,{className:"p-0",children:[e.jsx(ee,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{color:"orange",width:25,height:25}),e.jsx(se,{className:"text-base font-semibold",children:"Some features are disabled!"})]})}),e.jsx(F,{}),e.jsx(ae,{children:e.jsx("div",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex flex-col justify-center gap-2",children:[e.jsxs("span",{className:"text-sm ",children:["We trust you are doing well. To bolster the"," ",e.jsx("span",{className:"font-bold text-red-500 underline underline-offset-2",children:"security"})," ","and"," ",e.jsx("span",{className:"font-bold text-red-500 underline underline-offset-2",children:"reliability"})," ","of our platform, we seek your cooperation in verifying your email address. This verification is essential before you can"," ",e.jsx("span",{className:"font-bold text-red-500 underline underline-offset-2",children:"access certain features"})," ","on our website."]}),e.jsx("span",{className:"text-sm  ",children:"We appreciate your collaboration in maintaining the security and trustworthiness of our platform. Anticipating your verified email and the opportunity to see your contributions soon!"})]})})}),e.jsx(F,{}),e.jsxs("div",{className:"m-2 ml-auto flex w-max items-center justify-center gap-2 p-2",children:[e.jsx(ie,{htmlFor:"checkbox",className:"text-xs font-medium",children:"Don't show this again"}),e.jsx(le,{className:"rounded-full",onCheckedChange:s=>sessionStorage.setItem("checked",JSON.stringify(s)),id:"checkbox"})]})]})}),e.jsxs("section",{className:"mt-2 px-8",children:[e.jsx(te,{}),c?e.jsx("div",{className:"mx-auto mt-32 w-max",children:e.jsx("l-pulsar",{size:"50",speed:"1.75",color:"gray"})}):l&&l.length>0?e.jsx(e.Fragment,{children:e.jsx("div",{className:"grid grid-cols-4 gap-4 max-lg:grid-cols-3 max-md:grid-cols-2 max-sm:grid-cols-1",children:l==null?void 0:l.map((s,r)=>{var u,g,b,y,v,_,P,I,D,C,S,k;return l.length==r+1?e.jsxs(z,{ref:m,className:"w-full overflow-hidden border-none shadow-none",children:[e.jsx(H,{className:"flex flex-col gap-1 p-0",children:e.jsx(A,{to:`${((u=t.currentUser)==null?void 0:u.uid)===((g=s.host)==null?void 0:g.uid)?`/hosting-listings/edit/${s._id}`:`/listings/show/${s._id}`} `,className:"mt-2",replace:!0,children:e.jsx(L,{className:"rounded-xl",spaceBetween:10,cssMode:!0,navigation:{enabled:!0},pagination:!0,mousewheel:!0,modules:[T,U,E],children:(b=s.listingAssets)==null?void 0:b.map(a=>a.format==="mp4"?e.jsx(o,{className:"h-72 rounded-xl",children:e.jsx(h,{className:"mx-auto h-72 w-full rounded-xl object-cover",cldImg:p.image(a.public_id).setAssetType("video").format("auto:image")})},a.public_id):a.format==="mp3"?e.jsx(o,{children:e.jsx("img",{className:"mx-auto h-72 w-full rounded-lg border object-cover",src:"https://png.pngtree.com/png-clipart/20230303/ourmid/pngtree-vinyl-records-png-image_6629914.png",alt:"some image",loading:"lazy"})},a.public_id):e.jsx(o,{children:e.jsx(h,{cldImg:p.image(a.public_id),plugins:[M(),R({steps:[800,1e3,1400]})],className:"mx-auto h-72 w-full rounded-lg border object-cover"},a._id)},a.public_id))},r)})}),e.jsxs($,{className:"mt-2 flex justify-between p-0",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-base font-semibold capitalize",children:s.serviceTitle}),e.jsx("span",{className:"text-sm font-semibold text-gray-600",children:(y=s.host)==null?void 0:y.username}),e.jsx("div",{className:"w-full",children:e.jsxs("span",{className:"text-sm font-semibold text-gray-600",children:["Ends in"," ",B(new Date().setHours(0,0,0,0),new Date(s.endsAt))]})}),e.jsx("div",{className:"flex w-full items-center justify-between",children:e.jsxs("span",{className:"font-semibold",children:[O({value:s.price.toString(),intlConfig:{locale:"ph-PH",currency:"PHP"}})," ",e.jsx("span",{className:"text-sm font-semibold",children:"service"})]})})]}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-center gap-1",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"h-4 w-4",children:e.jsx("path",{fillRule:"evenodd",d:"M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.007 5.404.433c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.433 2.082-5.006z",clipRule:"evenodd"})}),e.jsx("span",{className:"text-xs font-bold",children:s.host.rating.length>0?(s.host.rating.map(a=>a.guestRating).reduce((a,j)=>a+j,0)/s.host.rating.length).toFixed(1):"No rating"})]}),((v=s.host)==null?void 0:v.uid)!==((_=t.currentUser)==null?void 0:_.uid)&&e.jsx(e.Fragment,{children:e.jsx(q,{listingID:s._id})})]})]})]},s._id):e.jsxs(z,{className:"w-full overflow-hidden border-none shadow-none",children:[e.jsx(H,{className:"flex flex-col gap-1 p-0",children:e.jsx(A,{to:`${((P=t.currentUser)==null?void 0:P.uid)===((I=s.host)==null?void 0:I.uid)?`/hosting-listings/edit/${s._id}`:`/listings/show/${s._id}`} `,className:"mt-2",replace:!0,children:e.jsx(L,{className:"rounded-xl",spaceBetween:10,cssMode:!0,navigation:{enabled:!0},pagination:!0,mousewheel:!0,modules:[T,U,E],children:(D=s.listingAssets)==null?void 0:D.map(a=>a.format==="mp4"?e.jsx(o,{className:"h-72 rounded-xl",children:e.jsx(h,{className:"mx-auto h-72 w-full rounded-xl object-cover",cldImg:p.image(a.public_id).setAssetType("video").format("auto:image")})},a.public_id):a.format==="mp3"?e.jsx(o,{children:e.jsx("img",{className:"mx-auto h-72 w-full rounded-lg border object-cover",src:"https://png.pngtree.com/png-clipart/20230303/ourmid/pngtree-vinyl-records-png-image_6629914.png",alt:"some image",loading:"lazy"})},a.public_id):e.jsx(o,{children:e.jsx(h,{cldImg:p.image(a.public_id),plugins:[M(),R({steps:[800,1e3,1400]})],className:"mx-auto h-72 w-full rounded-lg border object-cover"},a._id)},a.public_id))},r)})}),e.jsxs($,{className:"mt-2 flex justify-between p-0",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-base font-semibold capitalize",children:s.serviceTitle}),e.jsx("span",{className:"text-sm font-semibold text-gray-600",children:(C=s.host)==null?void 0:C.username}),e.jsx("div",{className:"w-full",children:e.jsxs("span",{className:"text-sm font-semibold text-gray-600",children:["Ends in"," ",B(new Date().setHours(0,0,0,0),new Date(s.endsAt))]})}),e.jsx("div",{className:"flex w-full items-center justify-between",children:e.jsxs("span",{className:"font-semibold",children:[O({value:s.price.toString(),intlConfig:{locale:"ph-PH",currency:"PHP"}})," ",e.jsx("span",{className:"text-sm font-semibold",children:"service"})]})})]}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-center gap-1",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",className:"h-4 w-4",children:e.jsx("path",{fillRule:"evenodd",d:"M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.007 5.404.433c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.433 2.082-5.006z",clipRule:"evenodd"})}),e.jsx("span",{className:"text-xs font-bold",children:s.host.rating.length>0?(s.host.rating.map(a=>a.guestRating).reduce((a,j)=>a+j,0)/s.host.rating.length).toFixed(1):"No rating"})]}),((S=s.host)==null?void 0:S.uid)!==((k=t.currentUser)==null?void 0:k.uid)&&e.jsx(e.Fragment,{children:e.jsx(q,{listingID:s._id})})]})]})]},s._id)})})}):e.jsx("div",{className:"mx-auto mt-16 w-max",children:e.jsx(ne,{loop:!1,animationData:re,className:"h-64 w-64"})}),d&&e.jsx("div",{className:"mx-auto w-max p-8",children:e.jsx("l-dot-pulse",{size:"43",speed:"1.3",color:"black"})}),n&&e.jsx("div",{className:"mx-auto w-max p-8",children:e.jsx(oe,{children:n.response.data.message})})]})]})}export{ue as default};
